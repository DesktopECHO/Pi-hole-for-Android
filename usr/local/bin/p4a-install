#!/bin/bash
export PIHOLE_SKIP_OS_CHECK=true
touch /etc/lighttpd/external.conf
mkdir -p /etc/pihole
[[ ! -f /etc/pihole/setupVars.conf ]] && /bin/cp -f /.setupVars /etc/pihole/setupVars.conf
subnetmask=$(ip route list table main | tail -n1) ; subnetmask=$(cut -d "/" -f2 <<< "$subnetmask") ; subnetmask=$(cut -d " " -f1 <<< "$subnetmask")
device=$(ip route list table main | tail -n1 | cut -d' ' -f 3)
ipaddr=$(ip route list table main | tail -n1) ; ipaddr=`echo $ipaddr | awk -F' ' ' { print $(NF-0) } '`
printf "\nPi-hole for Android // Device: $device // IP: $ipaddr // SubNet: $subnetmask\n"
sed -i "/IPV4_ADDRESS/c\IPV4_ADDRESS=$ipaddr/$subnetmask" /etc/pihole/setupVars.conf
sed -i "/PIHOLE_INTERFACE/c\PIHOLE_INTERFACE=$device"     /etc/pihole/setupVars.conf
curl -sSL https://raw.githubusercontent.com/DesktopECHO/pi-hole/master/automated%20install/basic-install.sh | bash /dev/stdin --unattended
